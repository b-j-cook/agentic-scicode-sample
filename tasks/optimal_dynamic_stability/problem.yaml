# =============================================================================
# Task Definition
# =============================================================================
#
# This file defines your task's metadata and structure.
#
# WORKFLOW:
# 1. Run: task new my_task_name
# 2. Edit this file - fill in all sections below
# 3. Edit steps/*.py - implement each sub-problem
# 4. (Optional) Edit background/*.md - add domain context
# 5. Run: task validate tasks/my_task_name/
# 6. Run: task compile tasks/my_task_name/
#
# =============================================================================


# TASK IDENTIFIER
# ---------------
# A unique name for your task. Use descriptive snake_case names.
problem_id: "optimal_dynamic_stability"

# DISPLAY NAME
# ------------
# Human-readable title shown in listings and reports.
problem_name: "Optimal Dynamical Stabilization"

# DOMAIN
# ------
# Category for organization (physics, chemistry, biology, mathematics)
domain: "physics"

# Subdomain for organization
subdomain: "Computational Physics"


# =============================================================================
# PROBLEM DESCRIPTION (shown to LLM as context)
# =============================================================================
# Describe the overall problem. This appears at the start of prompts.

description: |
  This task investigates the limits of dynamical stabilization for a linear mass-spring system $\ddot{x} + u(t)x = 0$ under periodic stiffness modulation. 
  Using a bang-bang (square-wave) stiffness profile, you will find the absolute minimal average stiffness $\langle u \rangle$ required for stability. 
  
  The task involves:
  1. Generating symmetric bang-bang stiffness profiles.
  2. Implementing an analytic state propagator designed for numerical stability in the large-period (Large T) limit.
  3. Constructing the Floquet monodromy matrix and evaluating stability via the trace criterion.
  4. Using a shooting method to solve for switching times that produce periodic stabilization modes.
  5. Exploring the mathematical analogy to the 1D stationary Schrödinger equation.
  6. Identifying higher-order quantized stabilization modes (excited states).
  7. Verifying results against physical invariants like symplecticity and the Schrödinger analogy.
  8. Performing a parameter sweep to determine the global minimal average stiffness threshold.


# =============================================================================
# I/O SPECIFICATION (shown to LLM)
# =============================================================================
# Document the overall input/output contract. This helps the model understand
# what data types and formats to expect.

io_spec: |
  """
  Optimal Dynamical Stabilization Solver

  Parameters
  ----------
  u_plus : float
      Maximum stiffness value (u > 0).
  u_minus : float
      Minimum stiffness value (u < 0).
  T : float
      Period of the stiffness modulation (s).
  n_mode : int, optional
      The stabilization mode index (0: ground state, 1, 2...: excited states).
  u_minus_range : tuple (float, float)
      Range of negative stiffness to search for the stability threshold.
  
  Returns
  -------
  minimal_average_stiffness : float
      The absolute minimal average stiffness <u(t)> required for stable trajectories.
  optimal_ts : float
      The optimal switching time t_s that minimizes the average stiffness at the threshold.
  """


# =============================================================================
# DEPENDENCIES
# =============================================================================
# Python imports available to the model. These are prepended to generated code.

dependencies:
  - import numpy as np
  - from scipy.optimize import brentq, root_scalar
  - from scipy.linalg import eigh, expm
  - from scipy.integrate import solve_ivp


# =============================================================================
# STEPS
# =============================================================================
# List of step files in order (without .py extension).
# Each step should have a corresponding file: steps/01_step_name.py

steps:
  - 01_stiffness_profile
  - 02_state_propagation
  - 03_floquet_monodromy
  - 04_shooting_method
  - 05_schrodinger_analogy
  - 06_quantized_modes
  - 07_physical_verification
  - 08_minimal_stiffness_simulation


# =============================================================================
# BACKGROUND (OPTIONAL)
# =============================================================================
# Overall background shown when with_background=True.

background_main: |
  Minimal conditions for dynamic stability refer to the necessary criteria that system parameters must meet to ensure its response to disturbances remains bounded over time. This task extends Kapitza stabilization to its theoretical limit under periodic stiffness modulation.
  
  The fundamental model is a linear mass-spring system:
  $\ddot{x}(t) + u(t)x(t) = 0$
  where $u(t)$ is a T-periodic square wave (bang-bang control) switching between $u^+ > 0$ and $u^- < 0$.
  
  Key concepts:
  - **Floquet Theory**: The stability of the T-periodic system is determined by the monodromy matrix $M = \Phi(T)$. The system is stable if $|\text{Tr}(M)| \leq 2$.
  - **Large T Limit**: In regions of negative stiffness, the system behaves like an inverted pendulum. For large periods, careful analytic treatment using exponential forms is required to maintain numerical precision.
  - **Schrödinger Analogy**: The stability problem maps to a 1D stationary Schrödinger equation where the stiffness modulation acts as a potential well. Stabilization modes correspond to the bound states of the quantum system.
